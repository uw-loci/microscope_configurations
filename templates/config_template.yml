# ========== MICROSCOPE CONFIGURATION TEMPLATE ==========
# This template defines the structure for microscope hardware configuration files.
# Replace placeholder values with actual hardware specifications.
#
# IMPORTANT: This file contains ONLY hardware configuration and physical properties.
# - Imaging settings (exposure, gain, white balance): imageprocessing_<microscope>.yml
# - Autofocus parameters: autofocus_<microscope>.yml
#
# All hardware device IDs (objectives, detectors, stages) must match entries in
# the resources_LOCI.yml file located in the resources/ folder.

# ========== MICROSCOPE IDENTIFICATION ==========
microscope:
  name: 'MICROSCOPE_NAME'       # Unique identifier for this microscope (e.g., 'PPM', 'CAMM')
  type: 'MicroscopeType'        # e.g., 'Multimodal', 'UprightBrightfield', 'InvertedFluorescence'
  detector_in_use: null         # Runtime state - leave as null
  objective_in_use: null        # Runtime state - leave as null
  modality: null                # Runtime state - leave as null

# ========== MODALITY-SPECIFIC SETTINGS ==========
# Define each imaging modality available on this microscope.
# Include only properties inherent to the modality itself, not imaging parameters.

modalities:
  # Example: Brightfield transmitted light microscopy
  brightfield:
    type: 'brightfield'

    # Illumination control
    lamp:
      device: 'LED-Device-Name'     # Micro-Manager device name
      control_type: 'voltage'       # Options: 'voltage', 'current', 'digital'

    # Background correction settings
    background_correction:
      enabled: true                 # Enable/disable background correction
      method: 'divide'              # Options: 'divide', 'subtract', 'none'
      base_folder: "D:/path/to/backgrounds"
      # Path pattern: {base_folder}/{microscope}/brightfield/{magnification}x/{detector}/background.tif

  # Example: Polarized light microscopy (PPM)
  ppm:
    type: 'polarized'

    # Rotation stage for polarizer control (separate from XYZ stage)
    rotation_stage:
      device: 'LOCI_STAGE_PI_001'   # Must match resources_LOCI.yml
      type: 'polarizer'             # Options: 'polarizer', 'waveplate', 'filter_wheel'

    # Polarizer rotation angles
    rotation_angles:
      - name: 'negative'
        tick: -7                    # Device-specific units (e.g., 1 tick = 1 degree)
      - name: 'crossed'
        tick: 0
      - name: 'positive'
        tick: 7
      - name: 'uncrossed'
        tick: 90

    background_correction:
      enabled: true
      method: 'divide'
      base_folder: "D:/path/to/backgrounds"
      # Path pattern: {base_folder}/polarized/{angle_name}_background.tif

  # Example: Second Harmonic Generation (SHG) multiphoton imaging
  shg:
    type: 'multiphoton'

    # Laser control
    laser:
      device: 'Chameleon'
      wavelength_nm: 800
      wavelength_range_nm: [690, 1040]

    # Variable magnification through scanning zoom
    magnification_control:
      type: 'zoom'
      range: [0.5, 10.0]            # Min/max zoom factors

    background_correction:
      enabled: false                # Typically disabled for multiphoton

  # Example: Fluorescence imaging
  fluorescence:
    type: 'fluorescence'

    # Light source
    lamp:
      device: 'Mercury-Lamp'
      control_type: 'digital'

    # Filter control
    filter_wheel:
      device: 'FilterWheel-Device'
      filters:
        - name: 'DAPI'
          position: 1
          excitation_nm: 350
          emission_nm: 470
        - name: 'FITC'
          position: 2
          excitation_nm: 488
          emission_nm: 525

    background_correction:
      enabled: true
      method: 'subtract'
      base_folder: "D:/path/to/backgrounds"

# ========== AVAILABLE HARDWARE ==========
# Lists all hardware components available on this microscope.
# All combinations of modality/objective/detector are valid unless
# specifically restricted by compatible_modalities in detectors section.

hardware:
  # Objective lenses
  objectives:
    - id: 'LOCI_OBJECTIVE_001'      # Must match resources_LOCI.yml entry
      # Pixel size for camera-based detection (fixed)
      pixel_size_xy_um:
        LOCI_DETECTOR_001: 1.105    # Detector ID: pixel size in micrometers
        LOCI_DETECTOR_002: 0.876

    - id: 'LOCI_OBJECTIVE_002'
      pixel_size_xy_um:
        LOCI_DETECTOR_001: 0.553
        LOCI_DETECTOR_002: 0.438
      # For scanning modalities with variable pixel size
      scan_parameters:
        base_fov_um: 500            # Field of view at zoom = 1.0
        # Actual pixel size = base_fov_um / (scan_resolution * zoom_factor)

    - id: 'LOCI_OBJECTIVE_003'
      pixel_size_xy_um:
        LOCI_DETECTOR_001: 0.277
        LOCI_DETECTOR_002: 0.219

  # Detectors (cameras, PMTs, etc.)
  detectors:
    - 'LOCI_DETECTOR_001'           # Camera for brightfield/fluorescence
    - 'LOCI_DETECTOR_002'           # Alternative camera (e.g., RGB prism)
    - 'LOCI_PMT_001'                # PMT for multiphoton imaging

# ========== STAGE CONFIGURATION ==========
# XYZ stage for sample positioning only.
# Device mappings (x_device, y_device, z_device) are defined in resources_LOCI.yml.
# Rotation stages are defined in modality sections, NOT here.

stage:
  stage_id: 'LOCI_STAGE_001'        # Must match resources_LOCI.yml entry

  # Movement limits in micrometers
  limits:
    x_um:
      low: -36000                   # Minimum X position
      high: 34000                   # Maximum X position
    y_um:
      low: -39000
      high: 34000
    z_um:
      low: -5601                    # Stage raised (sample close to objective)
      high: -1600                   # Stage lowered (sample far from objective)
    f_um:                           # Optional: separate focus axis if stage has one
      low: -18000
      high: 0

  # ========== STAGE INSERT CONFIGURATION (Optional) ==========
  # For microscopes with interchangeable slide holders.
  # Defines the viewable aperture (light transmission window) for each insert type.
  # Only the aperture area is shown in the Stage Map visualization.
  #
  # CALIBRATION PROCEDURE (using 4 reference points):
  #   Center the objective on each edge and record stage positions:
  #   1. aperture_left_x_um:   Left edge of aperture (stage X when edge is centered in FOV)
  #   2. aperture_right_x_um:  Right edge of aperture
  #   3. slide_top_y_um:       Top edge of slide glass
  #   4. slide_bottom_y_um:    Bottom edge of slide glass
  #
  # The system calculates aperture dimensions from these measurements.

  inserts:
    # Safety margin around slides for "legal zone" computation (micrometers)
    slide_margin_um: 2000

    # Default insert configuration to use
    default: single_h

    # Insert configurations
    configurations:
      single_h:
        name: "Single Slide (Horizontal)"
        description: "Standard single slide holder with horizontal orientation"

        # Calibration reference points (measured in micrometers)
        aperture_left_x_um: 33404       # Stage X when left aperture edge is centered
        aperture_right_x_um: -35085     # Stage X when right aperture edge is centered
        aperture_top_y_um: 33007        # Stage Y when top aperture edge is centered
        aperture_bottom_y_um: -38294    # Stage Y when bottom aperture edge is centered
        slide_top_y_um: 12220           # Stage Y when top of slide glass is centered
        slide_bottom_y_um: -11654       # Stage Y when bottom of slide glass is centered

        # Estimated aperture height (less critical for accuracy)
        aperture_height_mm: 60.0        # Vertical opening size in millimeters

        # Standard slide dimensions
        slide_width_mm: 75              # 3 inches (horizontal orientation)
        slide_height_mm: 25             # 1 inch

      single_v:
        name: "Single Slide (Vertical)"
        description: "Standard single slide holder with vertical orientation"

        aperture_left_x_um: 0
        aperture_right_x_um: 60000
        slide_top_y_um: 0
        slide_bottom_y_um: 75000        # Slide is 75mm tall when vertical

        aperture_height_mm: 55.0
        slide_width_mm: 25              # Rotated dimensions
        slide_height_mm: 75

      quad_v:
        name: "Four Slides (Vertical)"
        description: "Four slides arranged vertically"

        aperture_left_x_um: 0
        aperture_right_x_um: 120000
        slide_top_y_um: 0
        slide_bottom_y_um: 75000

        aperture_height_mm: 55.0
        slide_width_mm: 25
        slide_height_mm: 75

        # Multiple slide configuration
        slide_spacing_mm: 30.0          # Center-to-center distance between slides
        num_slides: 4

# ========== GENERAL SETTINGS ==========

# Standard microscope slide dimensions
slide_size_um:
  x: 40000      # 40mm = 40,000 micrometers
  y: 20000      # 20mm

# Optional: Objective turret/slider control
objective_slider:
  device: 'Turret:O:35'             # Micro-Manager device name
  label_device: 'Label'             # Device that reports current position

# ========== CONFIGURATION NOTES ==========
#
# 1. SEPARATION OF CONCERNS:
#    - This file: Hardware configuration and physical properties only
#    - imageprocessing_<microscope>.yml: Exposure, gain, white balance settings
#    - autofocus_<microscope>.yml: Autofocus parameters per objective
#
# 2. HARDWARE REFERENCES:
#    - All device IDs must match entries in resources_LOCI.yml
#    - Objective IDs: LOCI_OBJECTIVE_<manufacturer>_<magnification>_<variant>_<number>
#    - Detector IDs: LOCI_DETECTOR_<manufacturer>_<number>
#    - Stage IDs: LOCI_STAGE_<manufacturer>_<number>
#
# 3. PIXEL SIZE:
#    - For fixed detectors: Specify pixel_size_xy_um per objective/detector pair
#    - For scanning modalities: Use scan_parameters with base_fov_um
#    - Pixel size = base_fov_um / (scan_resolution * zoom_factor)
#
# 4. BACKGROUND CORRECTION:
#    - Each modality defines its own correction method
#    - Methods: 'divide' (flatfield), 'subtract' (dark subtraction), 'none'
#    - Path patterns vary by modality (see examples above)
#
# 5. STAGE CONFIGURATION:
#    - XYZ stages: Sample positioning only (defined here)
#    - Rotation stages: Part of modality definition (e.g., polarizer rotation)
#    - Stage limits should match or exceed aperture calibration bounds
#
# 6. MODALITY TYPES:
#    - 'brightfield': Transmitted light with lamp control
#    - 'polarized': Requires rotation_stage and rotation_angles
#    - 'fluorescence': Requires filter_wheel or excitation control
#    - 'multiphoton': Laser-based with optional magnification_control
#
# 7. STAGE INSERTS (Optional):
#    - Only needed for microscopes with interchangeable slide holders
#    - Calibration defines viewable aperture for Stage Map visualization
#    - Multiple configurations allow switching between insert types
