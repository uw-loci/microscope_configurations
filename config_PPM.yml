# ========== PPM MICROSCOPE CONFIGURATION ==========
# Hardware and physical configuration only
# Imaging conditions (exposure, gain, white balance) are in imageprocessing_PPM.yml
# Autofocus settings are in autofocus_PPM.yml

ppm_optics : 1 # change to "NA" if you want BF
ppm_pizstage_offset : -1804

microscope:
  name: 'PPM'
  type: 'UprightBrightfield'
  detector_in_use: null
  objective_in_use: null
  modality: null

test-push:
  MSN: 'PPM_001'

# ========== MODALITY-SPECIFIC SETTINGS ==========
modalities:
  ppm:
    type: 'polarized'
    rotation_stage:
      device: 'LOCI_STAGE_PI_001'
      type: 'polarizer'
    rotation_angles:
      - name: 'negative'
        tick: -7  # 1 tick = 1 degrees
      - name: 'crossed'
        tick: 0   # 1 tick = 1 degrees
      - name: 'positive'
        tick: 7   # 1 tick = 1 degrees
      - name: 'uncrossed'
        tick: 90  # 1 tick = 1 degrees

  brightfield:
    type: 'brightfield'

# ========== AVAILABLE HARDWARE ==========
# Lists of available hardware components on this microscope.
# All combinations of modality/objective/detector are currently valid.
# NOTE: If specific combinations need to be restricted in the future,
#       consider adding a 'restricted_combinations' section or reverting
#       to explicit profile definitions.
hardware:
  objectives:
    - id: 'LOCI_OBJECTIVE_OLYMPUS_10X_001'
      pixel_size_xy_um:
        LOCI_DETECTOR_TELEDYNE_001: 0.4537  # MicroPublisher 6
        LOCI_DETECTOR_JAI_001: 0.347        # JAI prism detector
    - id: 'LOCI_OBJECTIVE_OLYMPUS_20X_POL_001'
      pixel_size_xy_um:
        LOCI_DETECTOR_TELEDYNE_001: 0.2271
        LOCI_DETECTOR_JAI_001: 0.1725
    - id: 'LOCI_OBJECTIVE_OLYMPUS_40X_POL_001'
      pixel_size_xy_um:
        LOCI_DETECTOR_TELEDYNE_001: 0.1142
        LOCI_DETECTOR_JAI_001: 0.0871

  detectors:
    - 'LOCI_DETECTOR_TELEDYNE_001'   # MicroPublisher 6
    - 'LOCI_DETECTOR_JAI_001'        # JAI prism detector

# ========== STAGE CONFIGURATION ==========
stage:
  stage_id: 'LOCI_STAGE_PRIOR_001'  # Prior XYZ stage
  limits:
    # XY limits should match or exceed aperture calibration bounds
    # (aperture_left/right_x_um, aperture_top/bottom_y_um in insert config below)
    x_um:
      low: -36000   # Must be <= aperture_right_x_um (-35085)
      high: 35500   # Must be >= aperture_left_x_um (34873)
    y_um:
      low: -39000   # Must be <= aperture_bottom_y_um (-38294)
      high: 34000   # Must be >= aperture_top_y_um (33007)
    z_um:
      low: -5601 #stage raised with sample close to objective, this is the important one to NOT DAMAGE OBJECTIVE. SET CAREFULLY WITH HIGHEST POWER OBJECTIVE.
      high: -1600 #stage lowered far from objective

  # ========== STAGE INSERT CONFIGURATION ==========
  # Defines the viewable aperture (light transmission window) for each insert type.
  # Only the aperture area is shown in the Stage Map.
  #
  # CALIBRATION using 4 reference points (center the objective on each edge):
  #   1. aperture_left_x_um:  Left edge of aperture (black edge in center of FOV)
  #   2. aperture_right_x_um: Right edge of aperture (black edge in center of FOV)
  #   3. slide_top_y_um:      Top edge of slide glass (edge in center of FOV)
  #   4. slide_bottom_y_um:   Bottom edge of slide glass (edge in center of FOV)
  #
  # The system calculates aperture width from left/right X coordinates.
  # Aperture height is estimated (default 60mm) - exact value less critical.
  # The slide is assumed centered vertically within the aperture.
  inserts:
    # Safety margin around slides for "legal zone" computation (um)
    slide_margin_um: 2000

    # Default insert configuration to use
    default: single_h

    # Insert configurations - each defines its own aperture size and slide positions
    configurations:
      single_h:
        name: "Single Slide (Horizontal)"
        description: "Standard single slide holder with horizontal orientation"

        # ---------- CALIBRATION REFERENCE POINTS ----------
        # Measure these 4 positions with objective centered on each edge:
        aperture_left_x_um: 34873      # Stage X when left aperture edge is centered
        aperture_right_x_um: -35085 # Stage X when right aperture edge is centered
        aperture_top_y_um: 23007      # Stage Y when  aperture edge closest to microscope is centered
        aperture_bottom_y_um: -48114 # Stage Y when aperture edge farther from microscope is centered
        slide_top_y_um: -3207          # Stage Y when top of slide glass is centered
        slide_bottom_y_um: -21841   # Stage Y when bottom of slide glass is centered

        # Estimated aperture height (vertical) - less critical for accuracy
        aperture_height_mm: 60.0   # ~6cm Y distance opening

        # Slide dimensions (standard 1" x 3" slide)
        slide_width_mm: 75         # 3 inches
        slide_height_mm: 25        # 1 inch

      single_v:
        name: "Single Slide (Vertical)"
        description: "Standard single slide holder with vertical orientation"

        # Calibration reference points (measure when using this insert)
        aperture_left_x_um: 0
        aperture_right_x_um: 60000
        slide_top_y_um: 0
        slide_bottom_y_um: 75000   # Slide is 75mm tall when vertical

        aperture_height_mm: 55.0
        slide_width_mm: 25         # Rotated
        slide_height_mm: 75

      quad_v:
        name: "Four Slides (Vertical)"
        description: "Four slides arranged vertically"

        # Calibration reference points
        aperture_left_x_um: 0
        aperture_right_x_um: 120000
        slide_top_y_um: 0
        slide_bottom_y_um: 75000

        aperture_height_mm: 55.0
        slide_width_mm: 25
        slide_height_mm: 75

        # Spacing between slides (center-to-center distance)
        slide_spacing_mm: 30.0
        num_slides: 4

# ========== GENERAL SETTINGS ==========
slide_size_um:
  x: 40000
  y: 20000
